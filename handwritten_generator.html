<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Handwritten Assignment Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Homemade+Apple&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Indie+Flower&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Architects+Daughter&display=swap');
    
    .handwriting-preview {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 20px;
      min-height: 400px;
      font-family: 'Homemade Apple', cursive;
      line-height: 1.6;
    }
    
    .handwriting-preview.lined {
      background-image: 
        linear-gradient(#e5e7eb 1px, transparent 1px),
        linear-gradient(90deg, #e5e7eb 1px, transparent 1px);
      background-size: 100% 24px, 100% 100%;
    }
    
    .handwriting-preview.with-margins {
      border-left: 3px solid #ef4444;
      border-right: 3px solid #ef4444;
    }
  </style>
</head>

<body class="bg-gray-50 dark:bg-gray-900 min-h-screen">
  <!-- Navigation -->
  <nav class="bg-white dark:bg-gray-800 shadow-lg border-b border-gray-200 dark:border-gray-700">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center space-x-3">
          <div class="w-8 h-8 bg-gradient-to-r from-green-500 to-blue-600 rounded-lg flex items-center justify-center">
            <i class="fas fa-pen-fancy text-white text-sm"></i>
          </div>
          <h1 class="text-xl font-bold text-gray-900 dark:text-white">Handwritten Assignment Generator</h1>
        </div>
        <div class="flex items-center space-x-4">
          <a href="index.html" class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 text-sm font-medium">
            <i class="fas fa-arrow-left mr-1"></i>Back to Main
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Hero Section -->
    <div class="text-center mb-12">
      <h2 class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-4">
        Generate
        <span class="bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent">
          Handwritten Assignments
        </span>
      </h2>
      <p class="text-lg text-gray-600 dark:text-gray-300 max-w-3xl mx-auto">
        Convert your project titles and reports into beautiful handwritten assignments. 
        Perfect for academic submissions that require handwritten content.
      </p>
    </div>

    <!-- Main Generator Interface -->
    <div class="grid lg:grid-cols-2 gap-8">
      <!-- Input Section -->
      <div class="space-y-6">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden">
          <div class="bg-gradient-to-r from-green-500 to-blue-600 p-6">
            <div class="flex items-center space-x-3">
              <i class="fas fa-edit text-white text-xl"></i>
              <h3 class="text-2xl font-bold text-white">Assignment Details</h3>
            </div>
          </div>
          
          <div class="p-6 space-y-6">
            <!-- Project Title -->
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                <i class="fas fa-lightbulb mr-2"></i>Project/Assignment Title
              </label>
              <input type="text" id="projectTitle" placeholder="Enter your project title or assignment topic" 
                     class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition-colors">
            </div>

            <!-- Content -->
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                <i class="fas fa-file-text mr-2"></i>Assignment Content
              </label>
              <textarea id="assignmentContent" rows="8" placeholder="Enter your assignment content here. You can include introduction, methodology, findings, conclusion, etc..." 
                        class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition-colors resize-none"></textarea>
            </div>

            <!-- Student Details -->
            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  <i class="fas fa-user mr-2"></i>Student Name
                </label>
                <input type="text" id="studentName" placeholder="Your name" 
                       class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition-colors">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  <i class="fas fa-id-card mr-2"></i>Roll Number
                </label>
                <input type="text" id="rollNumber" placeholder="Roll number" 
                       class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition-colors">
              </div>
            </div>

            <!-- Subject Details -->
            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  <i class="fas fa-book mr-2"></i>Subject
                </label>
                <input type="text" id="subject" placeholder="Subject name" 
                       class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition-colors">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  <i class="fas fa-chalkboard-teacher mr-2"></i>Professor
                </label>
                <input type="text" id="professor" placeholder="Professor name" 
                       class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition-colors">
              </div>
            </div>
          </div>
        </div>

        <!-- Handwriting Customization -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden">
          <div class="bg-gradient-to-r from-green-500 to-blue-600 p-6">
            <div class="flex items-center space-x-3">
              <i class="fas fa-palette text-white text-xl"></i>
              <h3 class="text-2xl font-bold text-white">Handwriting Style</h3>
            </div>
          </div>
          
          <div class="p-6 space-y-6">
            <!-- Font Selection -->
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                <i class="fas fa-font mr-2"></i>Handwriting Font
              </label>
              <select id="handwritingFont" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-colors">
                <option value="Homemade Apple">Homemade Apple</option>
                <option value="Indie Flower">Indie Flower</option>
                <option value="Architects Daughter">Architects Daughter</option>
              </select>
            </div>

            <!-- Font Size -->
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                <i class="fas fa-text-height mr-2"></i>Font Size
              </label>
              <div class="flex items-center space-x-4">
                <input type="range" id="fontSize" min="8" max="20" value="12" 
                       class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700">
                <span id="fontSizeValue" class="text-sm font-medium text-gray-700 dark:text-gray-300 w-12">12pt</span>
              </div>
            </div>

            <!-- Ink Color -->
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                <i class="fas fa-palette mr-2"></i>Ink Color
              </label>
              <select id="inkColor" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-colors">
                <option value="#000000">Black</option>
                <option value="#0000FF">Blue</option>
                <option value="#006400">Dark Green</option>
                <option value="#8B0000">Dark Red</option>
              </select>
            </div>

            <!-- Paper Options -->
            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  <i class="fas fa-file mr-2"></i>Paper Lines
                </label>
                <div class="flex items-center">
                  <input type="checkbox" id="paperLines" checked 
                         class="w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500 dark:focus:ring-green-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                  <label for="paperLines" class="ml-2 text-sm text-gray-700 dark:text-gray-300">Show lined paper</label>
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  <i class="fas fa-border-style mr-2"></i>Paper Margins
                </label>
                <div class="flex items-center">
                  <input type="checkbox" id="paperMargins" checked 
                         class="w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500 dark:focus:ring-green-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                  <label for="paperMargins" class="ml-2 text-sm text-gray-700 dark:text-gray-300">Show margins</label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Preview Section -->
      <div class="space-y-6">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden">
          <div class="bg-gradient-to-r from-green-500 to-blue-600 p-6">
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-3">
                <i class="fas fa-eye text-white text-xl"></i>
                <h3 class="text-2xl font-bold text-white">Live Preview</h3>
              </div>
              <button type="button" id="generateBtn" class="bg-white text-green-600 px-4 py-2 rounded-lg font-semibold hover:bg-gray-100 transition-colors">
                <i class="fas fa-download mr-2"></i>Generate PDF
              </button>
            </div>
          </div>
          
          <div class="p-6">
            <div id="handwritingPreview" class="handwriting-preview lined with-margins">
              <div class="text-center mb-8">
                <h1 id="previewTitle" class="text-2xl font-bold mb-4">Your Assignment Title</h1>
                <div class="text-sm text-gray-600 space-y-1">
                  <p id="previewStudent">Student Name: [Your Name]</p>
                  <p id="previewRoll">Roll Number: [Roll Number]</p>
                  <p id="previewSubject">Subject: [Subject Name]</p>
                  <p id="previewProfessor">Professor: [Professor Name]</p>
                  <p id="previewDate">Date: [Current Date]</p>
                </div>
              </div>
              <div id="previewContent" class="text-left">
                <p>Your assignment content will appear here...</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Instructions -->
        <div class="bg-blue-50 dark:bg-blue-900/20 rounded-2xl p-6 border border-blue-200 dark:border-blue-800">
          <div class="flex items-start space-x-3">
            <i class="fas fa-info-circle text-blue-600 dark:text-blue-400 text-xl mt-1"></i>
            <div>
              <h4 class="font-semibold text-blue-900 dark:text-blue-100 mb-2">How to Use</h4>
              <ul class="text-blue-800 dark:text-blue-200 text-sm space-y-1">
                <li>• Enter your project title and assignment content</li>
                <li>• Customize the handwriting style and appearance</li>
                <li>• Preview your assignment in real-time</li>
                <li>• Click "Generate PDF" to download your handwritten assignment</li>
                <li>• The generated PDF will look like authentic handwritten work</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Loading Modal -->
  <div id="loadingModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6 text-center">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4"></div>
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Generating Your Assignment</h3>
        <p class="text-gray-600 dark:text-gray-300">Please wait while we create your handwritten PDF...</p>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
      <script src="config.js"></script>
    <script>
    // Font size slider
    const fontSizeSlider = document.getElementById('fontSize');
    const fontSizeValue = document.getElementById('fontSizeValue');
    
    fontSizeSlider.addEventListener('input', function() {
      fontSizeValue.textContent = this.value + 'pt';
      updatePreview();
    });

    // Update preview function
    function updatePreview() {
      const title = document.getElementById('projectTitle').value || 'Your Assignment Title';
      const content = document.getElementById('assignmentContent').value || 'Your assignment content will appear here...';
      const studentName = document.getElementById('studentName').value || '[Your Name]';
      const rollNumber = document.getElementById('rollNumber').value || '[Roll Number]';
      const subject = document.getElementById('subject').value || '[Subject Name]';
      const professor = document.getElementById('professor').value || '[Professor Name]';
      const font = document.getElementById('handwritingFont').value;
      const fontSize = document.getElementById('fontSize').value;
      const inkColor = document.getElementById('inkColor').value;
      const paperLines = document.getElementById('paperLines').checked;
      const paperMargins = document.getElementById('paperMargins').checked;
      
      // Update preview elements
      document.getElementById('previewTitle').textContent = title;
      document.getElementById('previewStudent').textContent = `Student Name: ${studentName}`;
      document.getElementById('previewRoll').textContent = `Roll Number: ${rollNumber}`;
      document.getElementById('previewSubject').textContent = `Subject: ${subject}`;
      document.getElementById('previewProfessor').textContent = `Professor: ${professor}`;
      document.getElementById('previewDate').textContent = `Date: ${new Date().toLocaleDateString()}`;
      document.getElementById('previewContent').innerHTML = content.replace(/\n/g, '<br>');
      
      // Update preview styling
      const preview = document.getElementById('handwritingPreview');
      preview.style.fontFamily = font;
      preview.style.fontSize = fontSize + 'pt';
      preview.style.color = inkColor;
      
      // Update paper options
      preview.classList.toggle('lined', paperLines);
      preview.classList.toggle('with-margins', paperMargins);
    }

    // Add event listeners for all inputs
    const inputs = ['projectTitle', 'assignmentContent', 'studentName', 'rollNumber', 'subject', 'professor'];
    inputs.forEach(id => {
      document.getElementById(id).addEventListener('input', updatePreview);
    });

    const selects = ['handwritingFont', 'inkColor'];
    selects.forEach(id => {
      document.getElementById(id).addEventListener('change', updatePreview);
    });

    const checkboxes = ['paperLines', 'paperMargins'];
    checkboxes.forEach(id => {
      document.getElementById(id).addEventListener('change', updatePreview);
    });

    // Generate PDF function
    document.getElementById('generateBtn').addEventListener('click', async function(e) {
      e.preventDefault(); // Prevent any default form submission
      console.log('Generate button clicked!');
      const loadingModal = document.getElementById('loadingModal');
      loadingModal.classList.remove('hidden');
      
      try {
        // Collect form data
        const formData = {
          projectTitle: document.getElementById('projectTitle').value,
          assignmentContent: document.getElementById('assignmentContent').value,
          studentName: document.getElementById('studentName').value,
          rollNumber: document.getElementById('rollNumber').value,
          subject: document.getElementById('subject').value,
          professor: document.getElementById('professor').value,
          handwritingFont: document.getElementById('handwritingFont').value,
          fontSize: parseInt(document.getElementById('fontSize').value),
          inkColor: document.getElementById('inkColor').value,
          paperLines: document.getElementById('paperLines').checked,
          paperMargins: document.getElementById('paperMargins').checked
        };
        
        // Validate required fields
        const requiredFields = ['projectTitle', 'assignmentContent', 'studentName', 'rollNumber', 'subject', 'professor'];
        for (const field of requiredFields) {
          if (!formData[field]) {
            showNotification(`Please fill in the ${field.replace(/([A-Z])/g, ' $1').toLowerCase()} field.`, 'error');
            loadingModal.classList.add('hidden');
            return;
          }
        }
        
        // Submit to API
        console.log('Submitting to API with data:', formData);
        const response = await fetch(`${window.API_CONFIG.apiBaseUrl}/api/submit-handwritten-request`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });
        console.log('API response received:', response);
        
        const data = await response.json();
        
        if (data.success) {
          console.log('API call successful, request_id:', data.request_id);
          
          // Use a simpler approach - open the download URL in a new tab
          const downloadUrl = `${window.API_CONFIG.apiBaseUrl}/api/generate-handwritten/${data.request_id}/pdf`;
          
          // Open in new tab to trigger download
          window.open(downloadUrl, '_blank');
          
          console.log('Download URL opened in new tab:', downloadUrl);
          showNotification('Handwritten assignment generated! Check your downloads folder.', 'success');
        } else {
          console.log('API call failed:', data);
          showNotification('Error generating assignment. Please try again.', 'error');
        }
      } catch (error) {
        console.error('Error:', error);
        showNotification('Error connecting to server. Please try again.', 'error');
      } finally {
        loadingModal.classList.add('hidden');
      }
    });

    // Notification system
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm transform transition-all duration-300 translate-x-full`;
      
      if (type === 'success') {
        notification.className += ' bg-green-500 text-white';
      } else if (type === 'error') {
        notification.className += ' bg-red-500 text-white';
      } else {
        notification.className += ' bg-blue-500 text-white';
      }
      
      notification.innerHTML = `
        <div class="flex items-center">
          <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'} mr-2"></i>
          <span>${message}</span>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.classList.remove('translate-x-full');
      }, 100);
      
      setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 5000);
    }

    // Initialize preview
    updatePreview();
  </script>
</body>
</html>
